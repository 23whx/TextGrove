# 一键生成所有图标文件

## 使用 ImageMagick 命令行工具（推荐）

如果你已经有 `favicon.webp` 或 `icon.webp`，可以使用 ImageMagick 快速生成所有尺寸。

### 1. 安装 ImageMagick

**Windows:**
```bash
# 使用 Chocolatey
choco install imagemagick

# 或从官网下载
# https://imagemagick.org/script/download.php#windows
```

**Mac:**
```bash
brew install imagemagick
```

**Linux:**
```bash
sudo apt-get install imagemagick  # Debian/Ubuntu
sudo yum install imagemagick      # CentOS/RHEL
```

### 2. 转换命令

在项目根目录运行以下命令（假设源文件是 `public/icon.webp`）：

```bash
# 进入 public 目录
cd public

# 生成所有 PNG 尺寸
magick icon.webp -resize 16x16 favicon-16x16.png
magick icon.webp -resize 32x32 favicon-32x32.png
magick icon.webp -resize 180x180 apple-touch-icon.png
magick icon.webp -resize 192x192 icon-192.png
magick icon.webp -resize 512x512 icon-512.png

# 生成 favicon.ico（包含多个尺寸）
magick icon.webp -resize 256x256 -define icon:auto-resize=256,128,96,64,48,32,16 favicon.ico

# 可选：生成 OG 图片（1200x630）
magick icon.webp -resize 1200x630 -background "#E8F5E9" -gravity center -extent 1200x630 og-image.png
```

### 3. 一键批处理脚本

**Windows (PowerShell):**

创建 `generate-icons.ps1`：
```powershell
# generate-icons.ps1
$source = "public\icon.webp"
$outputDir = "public"

Write-Host "🎨 开始生成图标..." -ForegroundColor Green

# 检查源文件
if (!(Test-Path $source)) {
    Write-Host "❌ 源文件不存在: $source" -ForegroundColor Red
    exit 1
}

# 检查 ImageMagick
try {
    magick -version | Out-Null
} catch {
    Write-Host "❌ 未安装 ImageMagick，请先安装：choco install imagemagick" -ForegroundColor Red
    exit 1
}

# 生成各种尺寸
Write-Host "📐 生成 16x16..." -ForegroundColor Cyan
magick $source -resize 16x16 "$outputDir\favicon-16x16.png"

Write-Host "📐 生成 32x32..." -ForegroundColor Cyan
magick $source -resize 32x32 "$outputDir\favicon-32x32.png"

Write-Host "📐 生成 180x180 (Apple Touch)..." -ForegroundColor Cyan
magick $source -resize 180x180 "$outputDir\apple-touch-icon.png"

Write-Host "📐 生成 192x192 (PWA)..." -ForegroundColor Cyan
magick $source -resize 192x192 "$outputDir\icon-192.png"

Write-Host "📐 生成 512x512 (PWA)..." -ForegroundColor Cyan
magick $source -resize 512x512 "$outputDir\icon-512.png"

Write-Host "📐 生成 favicon.ico..." -ForegroundColor Cyan
magick $source -resize 256x256 -define icon:auto-resize=256,128,96,64,48,32,16 "$outputDir\favicon.ico"

Write-Host "📐 生成 og-image.png (1200x630)..." -ForegroundColor Cyan
magick $source -resize 1200x630 -background "#E8F5E9" -gravity center -extent 1200x630 "$outputDir\og-image.png"

Write-Host ""
Write-Host "✅ 所有图标生成完成！" -ForegroundColor Green
Write-Host ""
Write-Host "生成的文件：" -ForegroundColor Yellow
Get-ChildItem $outputDir -Filter "*icon*.png", "favicon*" | ForEach-Object {
    $size = (Get-Item $_.FullName).Length / 1KB
    Write-Host "  ✓ $($_.Name) ($([math]::Round($size, 2)) KB)" -ForegroundColor White
}

Write-Host ""
Write-Host "下一步：访问 http://localhost:4321/favicon-test.html 测试图标" -ForegroundColor Magenta
```

运行：
```powershell
powershell -ExecutionPolicy Bypass -File generate-icons.ps1
```

**Mac/Linux (Bash):**

创建 `generate-icons.sh`：
```bash
#!/bin/bash

SOURCE="public/icon.webp"
OUTPUT_DIR="public"

echo "🎨 开始生成图标..."

# 检查源文件
if [ ! -f "$SOURCE" ]; then
    echo "❌ 源文件不存在: $SOURCE"
    exit 1
fi

# 检查 ImageMagick
if ! command -v magick &> /dev/null; then
    echo "❌ 未安装 ImageMagick"
    echo "Mac: brew install imagemagick"
    echo "Linux: sudo apt-get install imagemagick"
    exit 1
fi

# 生成各种尺寸
echo "📐 生成 16x16..."
magick "$SOURCE" -resize 16x16 "$OUTPUT_DIR/favicon-16x16.png"

echo "📐 生成 32x32..."
magick "$SOURCE" -resize 32x32 "$OUTPUT_DIR/favicon-32x32.png"

echo "📐 生成 180x180 (Apple Touch)..."
magick "$SOURCE" -resize 180x180 "$OUTPUT_DIR/apple-touch-icon.png"

echo "📐 生成 192x192 (PWA)..."
magick "$SOURCE" -resize 192x192 "$OUTPUT_DIR/icon-192.png"

echo "📐 生成 512x512 (PWA)..."
magick "$SOURCE" -resize 512x512 "$OUTPUT_DIR/icon-512.png"

echo "📐 生成 favicon.ico..."
magick "$SOURCE" -resize 256x256 -define icon:auto-resize=256,128,96,64,48,32,16 "$OUTPUT_DIR/favicon.ico"

echo "📐 生成 og-image.png (1200x630)..."
magick "$SOURCE" -resize 1200x630 -background "#E8F5E9" -gravity center -extent 1200x630 "$OUTPUT_DIR/og-image.png"

echo ""
echo "✅ 所有图标生成完成！"
echo ""
echo "生成的文件："
ls -lh "$OUTPUT_DIR" | grep -E "icon|favicon" | awk '{print "  ✓", $9, "(" $5 ")"}'

echo ""
echo "下一步：访问 http://localhost:4321/favicon-test.html 测试图标"
```

给予执行权限并运行：
```bash
chmod +x generate-icons.sh
./generate-icons.sh
```

---

## 不使用命令行工具的方案

### 方案 A：使用 RealFaviconGenerator（最简单）

1. 访问 https://realfavicongenerator.net/
2. 上传 `public/icon.webp`
3. 自动生成所有格式和尺寸
4. 下载压缩包
5. 解压到 `public/` 目录
6. 完成！

### 方案 B：使用在线转换工具

**CloudConvert:**
- https://cloudconvert.com/webp-to-png
- 支持批量转换和调整尺寸
- 可以一次性转换多个尺寸

**iLoveIMG:**
- https://www.iloveimg.com/zh-cn/resize-image
- 友好的中文界面
- 支持批量处理

### 方案 C：使用 Node.js 脚本

创建 `scripts/generate-icons.js`：
```javascript
const sharp = require('sharp');
const path = require('path');

const sizes = [
  { name: 'favicon-16x16.png', size: 16 },
  { name: 'favicon-32x32.png', size: 32 },
  { name: 'apple-touch-icon.png', size: 180 },
  { name: 'icon-192.png', size: 192 },
  { name: 'icon-512.png', size: 512 },
];

const source = path.join(__dirname, '../public/icon.webp');
const outputDir = path.join(__dirname, '../public');

async function generateIcons() {
  console.log('🎨 开始生成图标...\n');
  
  for (const { name, size } of sizes) {
    const output = path.join(outputDir, name);
    
    try {
      await sharp(source)
        .resize(size, size, {
          fit: 'contain',
          background: { r: 232, g: 245, b: 233, alpha: 1 }
        })
        .png()
        .toFile(output);
      
      console.log(`✓ 生成 ${name} (${size}x${size})`);
    } catch (error) {
      console.error(`✗ 生成 ${name} 失败:`, error.message);
    }
  }
  
  // 生成 OG 图片
  try {
    await sharp(source)
      .resize(1200, 630, {
        fit: 'contain',
        background: { r: 232, g: 245, b: 233, alpha: 1 }
      })
      .png()
      .toFile(path.join(outputDir, 'og-image.png'));
    
    console.log('✓ 生成 og-image.png (1200x630)');
  } catch (error) {
    console.error('✗ 生成 og-image.png 失败:', error.message);
  }
  
  console.log('\n✅ 所有图标生成完成！');
  console.log('下一步：访问 http://localhost:4321/favicon-test.html 测试图标\n');
}

generateIcons();
```

安装依赖并运行：
```bash
npm install sharp --save-dev
node scripts/generate-icons.js
```

---

## 验证生成结果

生成完成后：

1. **本地测试：**
   ```bash
   npm run dev
   # 访问 http://localhost:4321/favicon-test.html
   ```

2. **检查文件大小：**
   ```bash
   # Windows (PowerShell)
   Get-ChildItem public -Filter "*icon*.png", "favicon*" | Format-Table Name, Length
   
   # Mac/Linux
   ls -lh public/ | grep -E "icon|favicon"
   ```

3. **部署并验证：**
   ```bash
   npm run build
   # 部署到 Vercel/Netlify
   # 访问 https://yourdomain.com/favicon-test.html
   ```

---

## 文件清单

生成完成后，`public/` 目录应包含：

```
public/
├── favicon.ico              ✅ 必须（多尺寸 ICO）
├── favicon-16x16.png        ✅ 必须
├── favicon-32x32.png        ✅ 必须
├── apple-touch-icon.png     ✅ 必须（180x180）
├── icon-192.png             ✅ 必须（PWA）
├── icon-512.png             ✅ 必须（PWA）
├── og-image.png             ⭐ 推荐（社交分享）
├── favicon.webp             📦 可保留（备份）
└── icon.webp                📦 可保留（备份）
```

总文件数：6-8 个图标文件（必须 6 个，推荐 8 个）

